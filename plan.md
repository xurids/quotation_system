# 项目经费预算报价系统 - 设计思路文档

## 一、系统定位与核心价值

### 系统定位
这是一个专业的**项目经费预算报价系统**，主要用于企业或组织在项目立项阶段进行经费预算的编制、管理和报价。

### 核心价值
- **规范化预算编制**：提供标准化的预算编制流程
- **自动化计算**：减少人工计算错误，提高效率
- **多级费用分解**：支持精细化的费用结构管理
- **数据可视化**：直观展示预算构成和分布
- **快速报价生成**：基于预算数据生成专业的报价文档

## 二、系统架构设计

### 技术栈选择
- **前端**：Vue 3 + Element Plus + Axios
- **后端**：FastAPI + SQLAlchemy + SQLite
- **部署**：Docker + Docker Compose（可选）

### 架构层次
1. **表现层**：Vue 3 前端应用
2. **业务逻辑层**：FastAPI 后端服务
3. **数据访问层**：SQLAlchemy ORM
4. **数据存储层**：SQLite 数据库

## 三、核心功能模块设计

### 1. 项目管理模块
- **项目创建与维护**：支持项目的增删改查
- **项目信息管理**：项目名称、代码、基本信息等
- **项目状态跟踪**：草稿、审批中、已批准等状态

### 2. 费用管理模块
- **费用分类管理**：支持多级费用分类
- **功能模块管理**：5级功能分解（系统→子系统→一级→二级→三级→四级→五级）
- **工作量与单价管理**：支持人工录入和Excel导入
- **自动计算**：工作量 × 单价 = 总价
- **预算汇总**：自动汇总各级费用

### 3. 报价管理模块
- **报价单生成**：基于预算数据生成专业报价单
- **报价版本管理**：支持报价版本历史
- **客户管理**：关联客户信息
- **报价状态跟踪**：草稿、已发送、已接受、已拒绝等

### 4. 数据导入导出模块
- **Excel导入**：支持从Excel文件批量导入功能模块
- **Excel导出**：导出预算表和报价单
- **数据备份**：支持数据库备份和恢复

### 5. 系统管理模块
- **用户管理**：用户权限控制
- **系统配置**：默认单价、税率等参数设置
- **日志管理**：操作日志记录

## 四、数据模型设计

### 核心数据模型
1. **Project**（项目）
   - id, name, code, total_budget, created_at
   - 关联：ExpenseCategory, Quotation

2. **ExpenseCategory**（费用分类）
   - id, project_id, name, code, description, budget_amount, sort_order
   - 关联：FunctionModule

3. **FunctionModule**（功能模块）
   - id, category_id, system_name, subsystem_name, level1-level5, description, work_months, unit_price, total_price
   - 关联：ExpenseCategory

4. **Quotation**（报价单）
   - id, project_id, client_id, quotation_number, title, description, tax_rate, discount, total_amount, status
   - 关联：QuotationItem, QuotationVersion

5. **Client**（客户）
   - id, name, contact_person, email, phone, company, address
   - 关联：Quotation

6. **OtherCost**（其他费用）
   - id, project_id, cost_type, cost_name, description, cost_amount, calculation_rule, is_fixed, fixed_amount
   - 关联：Project

### 数据关系
- **项目** → **费用分类**：一对多
- **费用分类** → **功能模块**：一对多
- **项目** → **其他费用**：一对多
- **项目** → **报价单**：一对多
- **客户** → **报价单**：一对多
- **报价单** → **报价项目**：一对多
- **报价单** → **报价版本**：一对多

## 五、业务流程设计

### 1. 预算编制流程
1. **创建项目**：填写项目基本信息
2. **添加费用分类**：创建费用分类结构
3. **添加功能模块**：录入或导入功能模块
4. **设置工作量和单价**：为每个模块设置工作量和单价
5. **预算汇总**：系统自动计算各级费用
6. **预算审批**：提交审批流程

### 2. 报价流程
1. **选择项目**：选择要报价的项目
2. **选择客户**：关联客户信息
3. **设置报价参数**：税率、折扣等
4. **生成报价单**：基于预算数据生成报价
5. **发送报价**：将报价单发送给客户
6. **跟踪状态**：跟踪报价的状态变化

### 3. 数据导入流程
1. **上传Excel文件**：支持.xlsx和.xls格式
2. **解析Excel数据**：提取功能模块信息
3. **数据验证**：验证数据的完整性和正确性
4. **数据导入**：将数据导入到系统
5. **生成导入报告**：显示导入结果

## 六、技术实现要点

### 1. 前端实现
- **响应式设计**：适配不同屏幕尺寸
- **组件化开发**：封装可复用的UI组件
- **实时计算**：前端实时计算工作量和费用
- **数据可视化**：使用图表展示预算分布
- **Excel导入导出**：集成Excel处理库

### 2. 后端实现
- **RESTful API**：提供标准化的API接口
- **数据验证**：使用Pydantic进行数据验证
- **事务管理**：确保数据操作的原子性
- **自动计算**：后端实现复杂的计算逻辑
- **文件处理**：处理Excel文件的上传和解析

### 3. 数据库设计
- **规范化设计**：遵循数据库设计规范
- **索引优化**：提高查询性能
- **关系完整性**：确保数据的一致性
- **SQLite本地存储**：简化部署和维护

## 七、系统优势

### 1. 技术优势
- **现代技术栈**：使用Vue 3、FastAPI等现代框架
- **本地存储**：无需外部数据库服务
- **容器化部署**：支持Docker部署
- **自动API文档**：FastAPI自动生成API文档

### 2. 功能优势
- **5级功能分解**：支持精细化的费用管理
- **自动计算**：减少人工错误
- **Excel导入**：支持批量数据导入
- **预算汇总**：实时汇总各级费用
- **报价管理**：完整的报价流程支持

### 3. 部署优势
- **一键启动**：双击run.bat即可启动
- **零依赖**：无需安装数据库服务
- **数据备份**：简单的文件备份方式
- **跨平台**：支持Windows、Linux、Mac

## 八、实施路径

### 第一阶段：核心功能实现
1. **项目管理**：项目的增删改查
2. **费用管理**：费用分类和功能模块管理
3. **自动计算**：工作量和费用的自动计算
4. **预算汇总**：各级费用的自动汇总

### 第二阶段：高级功能实现
1. **Excel导入**：批量导入功能模块
2. **报价管理**：报价单生成和管理
3. **客户管理**：客户信息管理
4. **数据导出**：导出预算表和报价单

### 第三阶段：完善与优化
1. **系统配置**：系统参数的配置管理
2. **权限控制**：用户权限的精细管理
3. **性能优化**：系统性能的优化
4. **用户体验**：界面和交互的优化

## 九、总结

项目经费预算报价系统是一个专为企业项目预算管理和报价设计的专业系统，通过规范化的流程、自动化的计算和直观的界面，帮助用户高效完成项目预算编制和报价工作。系统采用现代化的技术栈，支持本地部署和容器化部署，具有良好的扩展性和可维护性。

系统的核心价值在于：
- **提高效率**：自动化计算和批量导入减少人工工作
- **确保准确性**：减少人工计算错误
- **标准化流程**：提供规范化的预算编制流程
- **数据可视化**：直观展示预算构成
- **专业报价**：生成专业的报价文档

通过本系统，用户可以更加高效、准确地完成项目预算编制和报价工作，为项目的顺利实施提供有力支持。